<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üçî Palatarius - Card√°pio Digital</title>
  <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    /* ==============================
       BLOCO 1 - VISUAL E ESTRUTURA
    ===============================*/

    :root {
      --primary: #c62828;
      --secondary: #0d47a1;
      --accent: #ffd54f;
      --bg: #f8f9fa;
      --text: #333;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      line-height: 1.6;
      overflow-x: hidden;
    }

    h2, h3, h4 {
      font-family: 'Russo One', sans-serif;
      color: var(--secondary);
    }

    header {
      background: linear-gradient(90deg, var(--secondary), var(--primary));
      color: white;
      text-align: center;
      padding: 1.2rem;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    }

    header h1 {
      font-size: 1.8rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    main {
      padding: 1rem;
    }

    /* Bot√µes */
    button {
      cursor: pointer;
      border: none;
      border-radius: 6px;
      padding: 0.6rem 1.2rem;
      margin-top: 0.5rem;
      transition: 0.2s ease;
      font-weight: 600;
    }

    button.primary {
      background: var(--secondary);
      color: white;
    }

    button.primary:hover {
      background: #1565c0;
    }

    button[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Inputs */
    input, select, textarea {
      width: 100%;
      padding: 0.5rem;
      margin: 0.3rem 0 0.8rem 0;
      border-radius: 4px;
      border: 1px solid #ccc;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    /* Card√°pio */
    .section-title {
      margin-top: 2rem;
      margin-bottom: 1rem;
      font-size: 1.5rem;
      color: var(--primary);
      border-bottom: 2px solid var(--accent);
      display: inline-block;
      padding-bottom: 0.2rem;
    }

    .card-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1rem;
    }

    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.15);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      transition: transform 0.2s;
    }

    .card:hover { transform: translateY(-4px); }

    .card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .card-content {
      padding: 0.8rem;
    }

    .card-content h3 {
      font-size: 1.1rem;
      color: var(--secondary);
      margin-bottom: 0.3rem;
    }

    .card-content p {
      font-size: 0.9rem;
      color: #444;
    }

    .price {
      color: var(--primary);
      font-weight: 700;
      margin-top: 0.4rem;
    }

    /* Modal de Ingredientes */
    #ingredientes-modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    #ingredientes-content {
      background: white;
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      padding: 1rem;
      overflow-y: auto;
      max-height: 90vh;
      box-shadow: 0 0 15px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .ingrediente-grupo {
      margin: 1rem 0;
      background: #f1f1f1;
      border-radius: 8px;
      padding: 0.5rem 1rem;
    }

    .ingrediente-grupo h4 {
      color: var(--primary);
      margin-bottom: 0.5rem;
    }

    .ingrediente-grupo label {
      display: block;
      font-size: 0.9rem;
      margin: 0.3rem 0;
    }

    .ingrediente-grupo input[type="checkbox"]:disabled + span {
      color: #aaa;
      text-decoration: line-through;
    }

    /* Carrinho */
    #cart {
      position: fixed;
      right: -400px;
      top: 0;
      width: 350px;
      height: 100vh;
      background: white;
      box-shadow: -2px 0 10px rgba(0,0,0,0.3);
      transition: right 0.3s ease;
      padding: 1rem;
      z-index: 10000;
      overflow-y: auto;
    }

    #cart.active { right: 0; }

    #cart h2 { color: var(--primary); }

    .cart-item {
      border-bottom: 1px solid #ddd;
      margin-bottom: 0.8rem;
      padding-bottom: 0.5rem;
    }

    .cart-total {
      margin-top: 1rem;
      font-weight: bold;
      color: var(--secondary);
    }

    .btn-whatsapp {
      background: #25d366;
      color: white;
      font-weight: 700;
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 8px;
      margin-top: 0.6rem;
      width: 100%;
    }

    /* Editor */
    #editor-screen {
      display: none;
      background: white;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      padding: 1.5rem;
      margin-top: 2rem;
    }

    #editor-screen.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    .editor-form {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: inset 0 0 6px rgba(0,0,0,0.1);
    }

    /* Abas do Editor */
    .editor-tabs {
      display: flex;
      justify-content: space-around;
      margin-bottom: 1rem;
    }

    .editor-tab {
      background: #ddd;
      color: #333;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: 0.3s;
    }

    .editor-tab.active {
      background: var(--secondary);
      color: white;
    }

    /* Ingredientes pausados */
    .paused {
      opacity: 0.4;
      text-decoration: line-through;
      pointer-events: none;
    }

    footer {
      text-align: center;
      padding: 1rem;
      margin-top: 2rem;
      background: linear-gradient(90deg, var(--secondary), var(--primary));
      color: white;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }

    /* Responsividade */
    @media(max-width:600px){
      header h1 { font-size: 1.3rem; }
      .card img { height: 120px; }
      #cart { width: 100%; }
    }

/* =======================
   BOT√ÉO "VENHA NOS VISITAR"
======================= */
.floating-btn {
  position: fixed;
  bottom: 1.5rem;
  left: 1.5rem;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 50px;
  padding: 0.8rem 1.5rem;
  font-size: 1rem;
  font-weight: 700;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  cursor: pointer;
  transition: all 0.3s;
  z-index: 10000;
}
.floating-btn:hover {
  background: var(--secondary);
  transform: scale(1.05);
}

/* =======================
   MODAL VISITE-NOS
======================= */
  #visite-modal {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.8);
    justify-content: center;
    align-items: center;
    z-index: 10001;
  }
  .visite-content {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    max-width: 700px;
    width: 90%;
    text-align: center;
    animation: fadeIn 0.4s ease;
  }
  .visite-content h2 {
    color: var(--secondary);
    margin-bottom: 0.5rem;
  }
  .visite-content p {
    color: #444;
    line-height: 1.6;
    font-size: 1rem;
    margin-bottom: 1rem;
  }
  .visite-fotos {
    display: flex;
    gap: 0.6rem;
    justify-content: center;
    flex-wrap: wrap;
  }
  .visite-fotos img {
    width: 30%;
    min-width: 150px;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0,0,0,0.3);
    object-fit: cover;
    height: 120px;
  }
  .visite-info {
    margin-top: 1rem;
  }
  .maps-btn, .whatsapp-btn {
    display: inline-block;
    margin-top: 0.5rem;
    padding: 0.6rem 1rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 700;
    transition: 0.2s;
  }
  .maps-btn {
    background: var(--accent);
    color: #222;
  }
  .maps-btn:hover {
    background: #ffe083;
  }
  .whatsapp-btn {
    background: #25d366;
    color: white;
  }
  .whatsapp-btn:hover {
    background: #1ebc58;
  }

  /* =======================
   Ajuste para celular ‚Äî Bot√£o flutuante menor
    ======================= */
    @media (max-width: 600px) {
      .floating-btn {
        bottom: 1rem;
        left: 1rem;
        padding: 0.8rem;
        border-radius: 50%;
        font-size: 1.4rem;
        width: 52px;
        height: 52px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 3px 8px rgba(0,0,0,0.25);
        z-index: 9500; /* Fica abaixo do carrinho e modal */
      }

      /* Oculta o texto longo "Venha nos Visitar!" em telas pequenas */
      .floating-btn::after {
        content: "üè†";
      }
      .floating-btn span, 
      .floating-btn::before {
        display: none !important;
      }
    }


  </style>
</head>

<body>
  <header>
    <h1>üçî Palatarius - Card√°pio Digital</h1>
  </header>

<main>
  <!-- =======================
       BLOCO 2 ‚Äî TELA DO CLIENTE (v7 - safe)
  ======================== -->
  <section id="cliente-screen" class="active">
    <h2 style="text-align:center; color:var(--secondary); font-family:'Russo One'; margin-bottom:1rem;">
      Bem-vindo √† Palatarius!
    </h2>

    <label for="cliente-nome">Nome:</label>
    <input type="text" id="cliente-nome" placeholder="Digite seu nome" required>

    <label for="cliente-telefone">N√∫mero de WhatsApp:</label>
    <input type="tel" id="cliente-telefone" placeholder="(XX) XXXXX-XXXX" required>

    <label for="cliente-tipo">Tipo de Pedido:</label>
    <select id="cliente-tipo">
      <option value="Retirada">Retirada</option>
      <option value="Entrega">Entrega</option>
    </select>

    <div id="endereco-container">
      <label for="cliente-endereco">Endere√ßo (caso entrega):</label>
      <input type="text" id="cliente-endereco" placeholder="Rua, n√∫mero, bairro">
    </div>

    <label for="cliente-local">Local de Entrega:</label>
    <select id="cliente-local">
      <option value="">Selecione...</option>
      <option value="KM39">KM 39 - R$4,00</option>
      <option value="KM40">KM 40 - R$4,00</option>
      <option value="KM41">KM 41 - R$4,00</option>
      <option value="KM42">KM 42 - R$4,00</option>
      <option value="Outro">Outro (a combinar no WhatsApp)</option>
    </select>

    <button id="continuar-btn" class="primary">Continuar para o Card√°pio</button>
  </section>

  <!-- =======================
       2Ô∏è‚É£ CARD√ÅPIO PRINCIPAL
  ======================== -->
  <section id="cardapio-screen" style="display:none;">
    <h2 class="section-title">üçî Hamb√∫rgueres</h2>
    <div class="card-grid" id="hamburgueres-grid"></div>

    <h2 class="section-title">üçü Batatas</h2>
    <div class="card-grid" id="batatas-grid"></div>

    <h2 class="section-title">ü•î Batatas Recheadas</h2>
    <div class="card-grid" id="batatas-recheadas-grid"></div>

    <h2 class="section-title">ü•ü Past√©is</h2>
    <div class="card-grid" id="pasteis-grid"></div>

    <h2 class="section-title">üå≠ Cachorros-Quentes</h2>
    <div class="card-grid" id="hotdogs-grid"></div>

    <h2 class="section-title">üç® Sorvetes & A√ßa√≠s</h2>
    <div class="card-grid" id="sorvetes-grid"></div>

    <h2 class="section-title">üßÉ Bebidas</h2>
    <div class="card-grid" id="bebidas-grid"></div>
  </section>

  <!-- =======================
       3Ô∏è‚É£ MODAL DE INGREDIENTES
  ======================== -->
  <div id="ingredientes-modal">
    <div id="ingredientes-content">
      <h3 id="modal-item-nome">Personalize seu pedido</h3>
      <div id="ingredientes-grupos"></div>

      <div class="ingrediente-grupo">
        <h4>üìù Observa√ß√£o:</h4>
        <textarea id="obs" placeholder="Ex: sem alface, ponto da carne, etc..."></textarea>
      </div>

      <button id="add-to-cart" class="primary">Adicionar ao Carrinho</button>
      <button id="close-modal">Cancelar</button>
    </div>
  </div>

  <!-- =======================
       4Ô∏è‚É£ CARRINHO DE PEDIDOS
  ======================== -->
  <aside id="cart">
    <h2>üõí Seu Pedido</h2>
    <div id="cart-items"></div>
    <div class="cart-total" id="cart-total">Total: R$ 0,00</div>
    <button class="btn-whatsapp" id="send-whatsapp">Enviar para WhatsApp</button>
    <button id="close-cart" class="primary" style="margin-top:0.5rem;">Fechar</button>
  </aside>

  <!-- =======================
       5Ô∏è‚É£ EDITOR ADMINISTRATIVO (v7 - +criar grupo sem apagar)
  ======================== -->
  <section id="editor-screen">
    <div class="editor-tabs">
      <div class="editor-tab active" id="tab-cardapio">üçî Card√°pio</div>
      <div class="editor-tab" id="tab-ingredientes">üßÇ Ingredientes</div>
    </div>

    <!-- üî∏ Aba Card√°pio -->
    <div id="editor-cardapio" class="editor-section">
      <h2>Gerenciar Card√°pio</h2>

      <div style="margin:1rem 0;">
        <button id="export-json" class="primary">Exportar JSON</button>
        <input type="file" id="import-json" accept="application/json" style="display:none;">
        <label for="import-json" class="primary" style="background:var(--primary);">Importar JSON</label>
      </div>

      <!-- ‚úÖ NOVO: Criar grupo de produtos sem apagar os existentes -->
      <div class="editor-form" style="border-bottom:1px solid var(--border); padding-bottom:1rem; margin-bottom:1rem;">
        <h3>Novo Grupo de Produtos</h3>
        <label>Nome do Grupo:</label>
        <input type="text" id="novo-grupo-cardapio-nome" placeholder="Ex: Combos, Promo√ß√µes, Sobremesas...">
        <button id="salvar-grupo-cardapio" class="primary" style="margin-top:0.5rem;">Criar Grupo</button>
        <p style="font-size:.85rem;color:#666;margin-top:.25rem;">
          Dica: os grupos existentes permanecem. Este bot√£o apenas adiciona um novo grupo ao final.
        </p>
      </div>

      <div class="editor-form">
        <h3>Novo Produto</h3>
        <label>Nome:</label>
        <input type="text" id="novo-nome" placeholder="Ex: X-Paladino">

        <label>Categoria:</label>
        <!-- Ser√° populado dinamicamente pelo BLOCO 4 (refreshCategoriaSelect) -->
        <select id="novo-categoria"></select>

        <label>Pre√ßo (R$):</label>
        <input type="number" id="novo-preco" step="0.01">

        <label>Imagem (nome do arquivo):</label>
        <input type="text" id="novo-imagem" placeholder="Ex: hadouken.jpg">

        <label>Descri√ß√£o:</label>
        <textarea id="novo-descricao" placeholder="Descri√ß√£o detalhada do produto"></textarea>

        <h4>Limites de Ingredientes</h4>
        <div class="grid-limites">
          <label>Carnes (1 padr√£o):</label>
          <input type="number" id="limite-carnes" min="0" value="1">

          <label>Molhos (2 padr√£o):</label>
          <input type="number" id="limite-molhos" min="0" value="2">

          <label>Crocantes (1 padr√£o):</label>
          <input type="number" id="limite-crocantes" min="0" value="1">

          <label>Prote√≠nas (2 padr√£o):</label>
          <input type="number" id="limite-proteinas" min="0" value="2">

          <label>Toppings (3 padr√£o):</label>
          <input type="number" id="limite-toppings" min="0" value="3">

          <label>Caldas (3 padr√£o):</label>
          <input type="number" id="limite-caldas" min="0" value="3">
        </div>

        <button id="salvar-produto" class="primary" style="margin-top:1rem;">Salvar Produto</button>
      </div>

      <div id="lista-produtos" style="margin-top:2rem;">
        <h3>Produtos Cadastrados:</h3>
        <div id="produtos-editor"></div>
      </div>

      <button id="close-editor" class="primary" style="margin-top:1rem;">Fechar Editor</button>
    </div>

    <!-- üî∏ Aba Ingredientes (mantida) -->
    <div id="editor-ingredientes" class="editor-section" style="display:none;">
      <h2>Gerenciar Ingredientes</h2>

      <div class="editor-form" style="border-bottom:1px solid var(--border); padding-bottom:1rem; margin-bottom:1rem;">
        <h3>Novo Grupo de Ingredientes</h3>
        <label>Nome do Grupo:</label>
        <input type="text" id="novo-grupo-nome" placeholder="Ex: Molhos Premium, Carnes Especiais...">
        <button id="salvar-grupo" class="primary" style="margin-top:0.5rem;">Salvar Grupo</button>
      </div>

      <div class="editor-form">
        <h3>Novo Ingrediente</h3>

        <label>Grupo:</label>
        <select id="novo-grupo"></select>

        <label>Nome do Ingrediente:</label>
        <input type="text" id="novo-ingrediente" placeholder="Ex: Cheddar, Alho Torrado...">

        <!-- ‚úÖ Campo adicionado -->
        <label>Valor (R$):</label>
        <input id="novo-ingrediente-valor" type="number" step="0.01" min="0" placeholder="Valor (R$)">

        <button id="salvar-ingrediente" class="primary" style="margin-top:0.5rem;">Salvar Ingrediente</button>
      </div>

      <div id="lista-ingredientes" style="margin-top:2rem;">
        <h3>Grupos e Ingredientes Cadastrados:</h3>
        <div id="ingredientes-editor"></div>
      </div>
    </div>
  </section>
  <!-- =======================
     SE√á√ÉO VISITE-NOS
======================= -->
<button id="visite-btn" class="floating-btn">üè† Venha nos Visitar!</button>

<div id="visite-modal">
  <div class="visite-content">
    <h2>üçî Bem-vindo √† Palatarius!</h2>
    <p>
      Um espa√ßo geek e aconchegante onde o sabor encontra a divers√£o!  
      Aqui a galera se re√∫ne pra saborear nossos hamb√∫rgueres artesanais,  
      curtir o fliperama, jogar PS4 e viver momentos √©picos com os amigos.  
      Venha sentir o <strong>Sabor Geek da Gal√°xia!</strong> üéÆ‚ú®
    </p>

    <div class="visite-fotos">
      <img src="assets/images/loja_1.jpg" alt="Fachada da Loja Palatarius">
      <img src="assets/images/fliperama.jpg" alt="Fliperama Palatarius">
      <img src="assets/images/ps4_area.jpg" alt="√Årea Gamer PS4">
    </div>

    <div class="visite-info">
      <p><strong>üìç Endere√ßo:</strong> BR-465, n¬∫ 199 ‚Äì Campo Lindo, Serop√©dica-RJ<br>
      (Pr√≥ximo √† LifeFit KM40)</p>
      <a href="https://www.google.com/maps/place/Palatarius/@-22.8060553,-43.6377571,19.5z/data=!4m6!3m5!1s0x9957204e3e3a25:0xdd752037ad31df35!8m2!3d-22.8059955!4d-43.6378252!16s%2Fg%2F11mdfkrt_t?hl=pt-BR&entry=ttu&g_ep=EgoyMDI1MTEwNC4xIKXMDSoASAFQAw%3D%3D"
         target="_blank" class="maps-btn">üó∫Ô∏è Ver no Google Maps</a>

      <p style="margin-top:0.5rem;"><strong>üìû WhatsApp:</strong> (21) 99759-9132</p>
      <a href="https://wa.me/5521997599132?text=Ol√°!%20Vim%20pelo%20card√°pio%20digital%20e%20quero%20saber%20mais%20sobre%20a%20Palatarius!"
         target="_blank" class="whatsapp-btn">üí¨ Falar com a Palatarius</a>
    </div>

    <button id="fechar-visite" class="primary" style="margin-top:1rem;">Fechar</button>
  </div>
</div>

  <!-- =======================
       6Ô∏è‚É£ RODAP√â SECRETO
  ======================== -->
  <footer id="palatarius-footer">
    ¬© 2025 <span>Palatarius</span> - O Sabor Geek da Gal√°xia
  </footer>
</main>

<script>
/* =========================================================
   BLOCO 3 ‚Äî FUNCIONALIDADES DO CLIENTE (v8)
   Agora com pre√ßos individuais por ingrediente
========================================================= */

let cliente = {};
let categorias = [];
let ingredientes = [];
let carrinho = [];
let itemSelecionado = null;

// ===============================
// FLUXO DO CLIENTE
// ===============================
document.getElementById("continuar-btn").addEventListener("click", () => {
  const nome = document.getElementById("cliente-nome").value.trim();
  const telefone = document.getElementById("cliente-telefone").value.trim();
  const tipo = document.getElementById("cliente-tipo").value;
  const endereco = document.getElementById("cliente-endereco").value.trim();
  const local = document.getElementById("cliente-local").value;
  if (!nome || !telefone) return alert("Por favor, preencha nome e n√∫mero!");

  let entrega = 0;
  if (tipo === "Entrega" && ["KM39", "KM40", "KM41", "KM42"].includes(local)) entrega = 4;
  cliente = { nome, telefone, tipo, endereco, local, entrega };

  document.getElementById("cliente-screen").style.display = "none";
  document.getElementById("cardapio-screen").style.display = "block";
  renderCardapio();
});

// ===============================
// RENDERIZA√á√ÉO DO CARD√ÅPIO
// ===============================
function renderCardapio() {
  const tela = document.getElementById("cardapio-screen");
  tela.innerHTML = "";

  if (!categorias?.length) {
    tela.innerHTML = `<p style="text-align:center;color:#777;">Nenhum produto cadastrado ainda.</p>`;
    return;
  }

  categorias.forEach(cat => {
    const sec = document.createElement("section");
    sec.classList.add("grupo-cardapio");
    sec.innerHTML = `<h2 class="section-title">${cat.nome}</h2>`;

    const grid = document.createElement("div");
    grid.className = "card-grid";

    if (!cat.itens?.length) {
      grid.innerHTML = `<p style="text-align:center;color:#aaa;">Nenhum produto neste grupo.</p>`;
    } else {
      cat.itens.forEach(item => {
        const img = item.imagem ? `assets/images/${item.imagem}` : "assets/images/placeholder.jpg";
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <img src="${img}" onerror="this.src='assets/images/placeholder.jpg'">
          <div class="card-content">
            <h3>${item.nome}</h3>
            <p>${item.descricao || ""}</p>
            <div class="price">R$ ${Number(item.preco || 0).toFixed(2)}</div>
            <button onclick="abrirModalIngredientes('${cat.nome}','${item.nome}')">Adicionar</button>
          </div>`;
        grid.appendChild(card);
      });
    }
    sec.appendChild(grid);
    tela.appendChild(sec);
  });
}

// ===============================
// MODAL DE INGREDIENTES (v8 com valores)
// ===============================
function abrirModalIngredientes(catNome, itemNome) {
  const cat = categorias.find(c => c.nome === catNome);
  const item = cat?.itens?.find(i => i.nome === itemNome);
  if (!item) return alert("Item n√£o encontrado!");

  itemSelecionado = item;
  document.getElementById("modal-item-nome").innerText = itemNome;
  document.getElementById("ingredientes-modal").style.display = "flex";
  gerarIngredientesModal(item);
}

function gerarIngredientesModal(item) {
  const cont = document.getElementById("ingredientes-grupos");
  cont.innerHTML = "";
  item.ingredientesPermitidos ||= {};
  item.limites ||= {};

  if (!ingredientes?.length) {
    cont.innerHTML = `<p style="color:#777;">Nenhum grupo de ingredientes cadastrado.</p>`;
    return;
  }

  const grupos = Object.keys(item.ingredientesPermitidos).length
    ? ingredientes.filter(g => Object.keys(item.ingredientesPermitidos).includes(g.grupo))
    : ingredientes;

  grupos.forEach(gr => {
    const div = document.createElement("div");
    div.className = "ingrediente-grupo";
    const limite = item.limites?.[gr.grupo] || getLimitePadrao(gr.grupo);
    let html = `<h4>${gr.grupo} (m√°x ${limite})</h4>`;

    const permitidos = item.ingredientesPermitidos?.[gr.grupo] || gr.opcoes.map(o => o.nome);
    const opcoes = gr.opcoes.filter(o => permitidos === "*" || permitidos.includes(o.nome));

    if (!opcoes.length) {
      html += `<p style="color:#999;">Nenhum ingrediente dispon√≠vel.</p>`;
    } else {
      opcoes.forEach(op => {
        const pausado = op.pausado === true;
        const valor = Number(op.valor || 0);
        const textoValor = valor > 0 ? ` (+R$ ${valor.toFixed(2)})` : "";
        html += `
          <label ${pausado ? 'class="paused"' : ''}>
            <input type="checkbox" 
                   name="${gr.grupo}" 
                   value="${op.nome}" 
                   data-valor="${valor}" 
                   ${pausado ? "disabled" : ""}>
            <span>${op.nome}${textoValor}</span>
          </label>`;
      });
    }

    div.innerHTML = html;
    cont.appendChild(div);

    // controle de limite
    div.querySelectorAll('input[type="checkbox"]').forEach(cb => {
      cb.addEventListener("change", e => {
        const checks = div.querySelectorAll('input:checked');
        if (checks.length > limite) {
          e.target.checked = false;
          alert(`M√°x. permitido: ${limite} em ${gr.grupo}`);
        }
      });
    });
  });
}

function getLimitePadrao(gr) {
  const pad = {
    "Carnes": 1, "Molhos": 2, "Crocantes Extras": 1,
    "Prote√≠nas": 2, "Acompanhamentos": 5,
    "Toppings": 3, "Caldas": 3, "Caldas Fini (+R$1)": 2
  };
  return pad[gr] || 1;
}

document.getElementById("close-modal").onclick = () => {
  document.getElementById("ingredientes-modal").style.display = "none";
  document.getElementById("obs").value = "";
  itemSelecionado = null;
};

// ===============================
// CARRINHO
// ===============================
document.getElementById("add-to-cart").addEventListener("click", () => {
  if (!itemSelecionado) return;

  const selecionados = {};
  let totalExtras = 0;

  document.querySelectorAll("#ingredientes-grupos .ingrediente-grupo").forEach(div => {
    const grupo = div.querySelector("h4").innerText.split(" (")[0];
    const checks = [...div.querySelectorAll("input:checked")];
    if (checks.length) {
      selecionados[grupo] = checks.map(i => i.value);
      totalExtras += checks.reduce((s, c) => s + Number(c.dataset.valor || 0), 0);
    }
  });

  const obs = document.getElementById("obs").value.trim();
  adicionarAoCarrinho(itemSelecionado, selecionados, obs, totalExtras);

  document.getElementById("ingredientes-modal").style.display = "none";
  document.getElementById("obs").value = "";
  itemSelecionado = null;
});

function adicionarAoCarrinho(item, ingredientesEscolhidos, obs, extras = 0) {
  const precoFinal = (Number(item.preco) || 0) + extras;
  carrinho.push({ ...item, precoFinal, ingredientesEscolhidos, obs });
  atualizarCarrinho();
}

function atualizarCarrinho() {
  const cont = document.getElementById("cart-items");
  cont.innerHTML = "";
  let total = 0;

  carrinho.forEach((it, i) => {
    total += Number(it.precoFinal) || 0;
    const div = document.createElement("div");
    div.className = "cart-item";
    let html = `<p><strong>${it.nome}</strong> - R$ ${it.precoFinal.toFixed(2)}</p>`;
    if (it.ingredientesEscolhidos) {
      for (const [g, l] of Object.entries(it.ingredientesEscolhidos)) {
        html += `<p style="font-size:0.85rem;color:#555;">${g}: ${l.join(", ")}</p>`;
      }
    }
    if (it.obs) html += `<p style="font-size:0.85rem;color:#777;"><em>Obs:</em> ${it.obs}</p>`;
    html += `<button onclick="removerItem(${i})" style="background:none;border:none;color:red;font-weight:bold;float:right;">x</button>`;
    div.innerHTML = html;
    cont.appendChild(div);
  });

  document.getElementById("cart-total").innerText = `Total: R$ ${total.toFixed(2)}`;
  document.getElementById("cart").classList.add("active");
}

function removerItem(i) {
  carrinho.splice(i, 1);
  atualizarCarrinho();
}

document.getElementById("close-cart").onclick = () =>
  document.getElementById("cart").classList.remove("active");

// ===============================
// WHATSAPP
// ===============================
document.getElementById("send-whatsapp").addEventListener("click", () => {
  if (!carrinho.length) return alert("Carrinho vazio!");

  let msg = `üçî *Pedido Palatarius*%0A`;
  msg += `üë§ *Cliente:* ${cliente.nome}%0Aüìû *Telefone:* ${cliente.telefone}%0Aüì¶ *Tipo:* ${cliente.tipo}%0A`;

  if (cliente.tipo === "Entrega") {
    msg += `üìç *Local:* ${cliente.local || "‚Äî"}%0Aüè† *Endere√ßo:* ${cliente.endereco || "‚Äî"}%0A`;
    msg += ["KM39","KM40","KM41","KM42"].includes(cliente.local)
      ? `üöö *Taxa de Entrega:* R$ 4,00%0A`
      : `üöö *Taxa de Entrega:* a combinar%0A`;
  }
  msg += `%0A=============================%0A`;

  let subtotal = 0;
  carrinho.forEach(it => {
    subtotal += it.precoFinal || 0;
    msg += `ü•™ *${it.nome}* - R$ ${it.precoFinal.toFixed(2)}%0A`;
    if (it.ingredientesEscolhidos) {
      for (const [g, l] of Object.entries(it.ingredientesEscolhidos)) {
        msg += `‚Ä¢ ${g}: ${l.join(", ")}%0A`;
      }
    }
    if (it.obs) msg += `üìù Obs: ${it.obs}%0A`;
    msg += `-----------------------------%0A`;
  });

  const taxa = cliente.entrega || 0;
  const total = subtotal + taxa;
  msg += `üí∞ *Subtotal:* R$ ${subtotal.toFixed(2)}%0A`;
  if (taxa > 0) msg += `üöö *Taxa:* R$ ${taxa.toFixed(2)}%0A`;
  msg += `üíµ *Total Geral:* R$ ${total.toFixed(2)}%0A%0A‚úÖ *Pedido gerado via Card√°pio Digital Palatarius*`;

  window.open(`https://wa.me/5521997599132?text=${msg}`, "_blank");
});
</script>


<script>
/* =========================================================
   BLOCO 4 ‚Äî EDITOR ADMINISTRATIVO AVAN√áADO (v9)
   Agora com campo de VALOR para ingredientes
   (Compat√≠vel com BLOCO 3 v8)
========================================================= */

// ===============================
// ACESSO SECRETO AO EDITOR
// ===============================
let clickCount = 0;
const footer = document.getElementById("palatarius-footer");
footer.addEventListener("click", () => {
  clickCount++;
  if (clickCount === 3) {
    const senha = prompt("üîê Digite a senha de acesso:");
    if (senha === "EdLeoMarc&2025") {
      document.getElementById("editor-screen").classList.add("active");
      alert("‚úÖ Acesso concedido ao editor Palatarius!");
      refreshCategoriaSelect();
      if (typeof atualizarSelectGrupos === "function") atualizarSelectGrupos();
      renderEditorProdutos();
      renderEditorIngredientes();
    } else {
      alert("‚ùå Senha incorreta!");
    }
    clickCount = 0;
  }
  setTimeout(() => (clickCount = 0), 1500);
});

// ===============================
// TROCA DE ABAS DO EDITOR
// ===============================
document.getElementById("tab-cardapio").addEventListener("click", () => ativarAba("cardapio"));
document.getElementById("tab-ingredientes").addEventListener("click", () => ativarAba("ingredientes"));

function ativarAba(aba) {
  document.querySelectorAll(".editor-tab").forEach(t => t.classList.remove("active"));
  document.querySelector(`#tab-${aba}`).classList.add("active");

  document.querySelectorAll(".editor-section").forEach(s => (s.style.display = "none"));
  document.getElementById(`editor-${aba}`).style.display = "block";

  if (aba === "cardapio") {
    refreshCategoriaSelect();
    renderEditorProdutos();
  }
  if (aba === "ingredientes") {
    if (typeof atualizarSelectGrupos === "function") atualizarSelectGrupos();
    renderEditorIngredientes();
  }
}

// ===============================
// ATUALIZA SELECT DE CATEGORIAS
// ===============================
function refreshCategoriaSelect() {
  const sel = document.getElementById("novo-categoria");
  if (!sel) return;
  sel.innerHTML = "";
  (categorias || []).forEach(c => {
    const opt = document.createElement("option");
    opt.value = c.nome;
    opt.textContent = c.nome;
    sel.appendChild(opt);
  });
}

// ===============================
// ADICIONAR PRODUTO
// ===============================
document.getElementById("salvar-produto").addEventListener("click", () => {
  const nome = document.getElementById("novo-nome").value.trim();
  const categoria = document.getElementById("novo-categoria").value;
  const preco = parseFloat(document.getElementById("novo-preco").value);
  const imagem = document.getElementById("novo-imagem").value.trim();
  const descricao = document.getElementById("novo-descricao").value.trim();

  if (!nome || isNaN(preco) || !imagem || !categoria) {
    alert("Preencha nome, imagem, pre√ßo e categoria!");
    return;
  }

  const limites = {
    Carnes: parseInt(document.getElementById("limite-carnes").value) || 0,
    Molhos: parseInt(document.getElementById("limite-molhos").value) || 0,
    "Crocantes Extras": parseInt(document.getElementById("limite-crocantes").value) || 0,
    Prote√≠nas: parseInt(document.getElementById("limite-proteinas").value) || 0,
    Toppings: parseInt(document.getElementById("limite-toppings").value) || 0,
    Caldas: parseInt(document.getElementById("limite-caldas").value) || 0
  };

  const grupo = categorias.find(c => c.nome === categoria);
  if (!grupo) return alert("Categoria n√£o encontrada!");

  grupo.itens ||= [];
  grupo.itens.push({
    nome, preco, imagem, descricao,
    limites,
    ingredientesPermitidos: {}
  });

  document.querySelectorAll("#editor-cardapio input, #editor-cardapio textarea").forEach(i => (i.value = ""));
  refreshCategoriaSelect();
  renderEditorProdutos();
  if (typeof renderCardapio === "function") renderCardapio();
  if (typeof salvarLocal === "function") salvarLocal();
});

// ===============================
// LISTAGEM DE PRODUTOS
// ===============================
function renderEditorProdutos() {
  const container = document.getElementById("produtos-editor");
  if (!container) return;
  container.innerHTML = "";

  categorias.forEach(cat => {
    const divCat = document.createElement("div");
    divCat.innerHTML = `<h3 style="color:var(--secondary);margin-top:1rem;">${cat.nome}</h3>`;
    (cat.itens || []).forEach((item, idx) => {
      const div = document.createElement("div");
      div.className = "editor-item";
      div.style = "background:#fff;margin:.3rem 0;padding:.4rem .6rem;border-radius:6px;box-shadow:0 0 3px #ccc;";
      div.innerHTML = `
        <strong>${item.nome}</strong> - R$ ${Number(item.preco || 0).toFixed(2)} 
        <small style="color:#555;">[${item.imagem || ""}]</small><br>
        <em style="font-size:.85rem;color:#777;">${item.descricao || ""}</em><br>
        <button class="btn-edit" onclick="editarProduto('${cat.nome.replace(/'/g, "\\'")}', ${idx})">‚úèÔ∏è Editar</button>
        <button class="btn-delete" onclick="excluirProduto('${cat.nome.replace(/'/g, "\\'")}', ${idx})">üóëÔ∏è Excluir</button>
      `;
      divCat.appendChild(div);
    });
    container.appendChild(divCat);
  });
}

// ===============================
// MODAL DE EDI√á√ÉO DE PRODUTO
// ===============================
let itemEmEdicaoRef = null;

// cria modal se n√£o existir
(function ensureProdutoModal() {
  if (document.getElementById("produto-modal")) return;
  const modal = document.createElement("div");
  modal.id = "produto-modal";
  modal.style = `
    display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);
    align-items:center;justify-content:center;z-index:9999;
  `;
  modal.innerHTML = `
    <div style="background:#fff;width:min(900px,95vw);max-height:90vh;overflow:auto;padding:1rem;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.2);">
      <h3>Editar Produto</h3>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:.75rem;">
        <div><label>Nome:</label><input type="text" id="pm-nome"></div>
        <div><label>Pre√ßo (R$):</label><input type="number" id="pm-preco" step="0.01"></div>
        <div><label>Imagem:</label><input type="text" id="pm-imagem" placeholder="hadouken.jpg"></div>
        <div style="grid-column:1/-1;"><label>Descri√ß√£o:</label><textarea id="pm-descricao" rows="3"></textarea></div>
      </div>
      <h4 style="margin-top:1rem;">Ingredientes Permitidos por Grupo</h4>
      <p style="margin:.25rem 0 .75rem;color:#555;font-size:.9rem;">
        Marque <strong>Selecionar grupo inteiro</strong> para liberar todas as op√ß√µes do grupo.
        Ou marque ingredientes espec√≠ficos. Cada ingrediente pode ter um <em>valor adicional</em>.
      </p>
      <div id="pm-grupos" style="display:grid;gap:.75rem;"></div>
      <div style="display:flex;gap:.5rem;margin-top:1rem;justify-content:flex-end;">
        <button id="pm-cancelar">Cancelar</button>
        <button id="pm-salvar" class="primary">Salvar Altera√ß√µes</button>
      </div>
    </div>
  `;
  document.body.appendChild(modal);
  document.getElementById("pm-cancelar").onclick = fecharProdutoModal;
  modal.onclick = e => { if (e.target === modal) fecharProdutoModal(); };
})();

function abrirProdutoModal() { document.getElementById("produto-modal").style.display = "flex"; }
function fecharProdutoModal() {
  document.getElementById("produto-modal").style.display = "none";
  itemEmEdicaoRef = null;
}

// fun√ß√£o padr√£o para limites
function getLimitePadraoLocal(grupoNome) {
  if (typeof getLimitePadrao === "function") return getLimitePadrao(grupoNome);
  const padroes = { Carnes: 1, Molhos: 2, "Crocantes Extras": 1, Prote√≠nas: 2, Acompanhamentos: 5, Toppings: 3, Caldas: 3 };
  return padroes[grupoNome] || 1;
}

// ABRIR MODAL DE EDI√á√ÉO DE PRODUTO
function editarProduto(catNome, idx) {
  const categoria = categorias.find(c => c.nome === catNome);
  if (!categoria) return;
  const item = categoria.itens[idx];
  if (!item) return;

  itemEmEdicaoRef = { catNome, idx };
  document.getElementById("pm-nome").value = item.nome || "";
  document.getElementById("pm-preco").value = item.preco || 0;
  document.getElementById("pm-imagem").value = item.imagem || "";
  document.getElementById("pm-descricao").value = item.descricao || "";

  const wrap = document.getElementById("pm-grupos");
  wrap.innerHTML = "";

  (ingredientes || []).forEach(gr => {
    const grupoNome = gr.grupo;
    const opcoes = gr.opcoes || [];
    const permitidos = item.ingredientesPermitidos?.[grupoNome];
    const limiteAtual = item.limites?.[grupoNome] ?? getLimitePadraoLocal(grupoNome);
    const isAll = permitidos === "*" || (Array.isArray(permitidos) && permitidos.length === opcoes.length);

    const bloco = document.createElement("div");
    bloco.className = "pm-grupo";
    bloco.style = "border:1px solid var(--border);border-radius:8px;padding:.6rem;";

    let html = `
      <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;">
        <div style="font-weight:600;color:var(--primary);">${grupoNome}</div>
        <div style="display:flex;align-items:center;gap:.5rem;">
          <label><input type="checkbox" class="pm-grupo-all" data-grupo="${grupoNome}" ${isAll ? "checked" : ""}> Selecionar grupo inteiro</label>
          <label>Limite: <input type="number" class="pm-grupo-limit" data-grupo="${grupoNome}" min="0" value="${parseInt(limiteAtual) || 0}" style="width:80px;"></label>
        </div>
      </div>
      <div class="pm-grupo-opcoes" data-grupo="${grupoNome}" style="margin-top:.5rem;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:.25rem .75rem;"></div>
    `;
    bloco.innerHTML = html;
    wrap.appendChild(bloco);

    const areaOp = bloco.querySelector(".pm-grupo-opcoes");
    opcoes.forEach(op => {
      const checked = isAll || (Array.isArray(permitidos) && permitidos.includes(op.nome));
      const valor = op.valor ?? 0;
      const opt = document.createElement("label");
      opt.style = "display:flex;align-items:center;gap:.4rem;padding:.2rem 0;";
      opt.innerHTML = `
        <input type="checkbox" class="pm-opcao" data-grupo="${grupoNome}" value="${op.nome}" ${checked ? "checked" : ""} ${isAll ? "disabled" : ""}>
        <span>${op.nome}</span>
        <input type="number" class="pm-opcao-valor" data-grupo="${grupoNome}" data-nome="${op.nome}" step="0.01" min="0" value="${valor}" style="width:70px;border:1px solid #ccc;border-radius:4px;padding:2px 4px;">
      `;
      areaOp.appendChild(opt);
    });
  });

  // Listener: selecionar grupo inteiro
  wrap.querySelectorAll(".pm-grupo-all").forEach(cb => {
    cb.addEventListener("change", e => {
      const grupo = e.target.dataset.grupo;
      const boxArea = wrap.querySelector(`.pm-grupo-opcoes[data-grupo="${grupo}"]`);
      const all = e.target.checked;
      boxArea.querySelectorAll(".pm-opcao").forEach(op => {
        op.checked = all ? true : op.checked;
        op.disabled = all;
      });
    });
  });

  abrirProdutoModal();
}
// ===============================
// SALVAR ALTERA√á√ïES DE PRODUTO (MODAL)
// ===============================
document.getElementById("pm-salvar").addEventListener("click", () => {
  if (!itemEmEdicaoRef) return;
  const { catNome, idx } = itemEmEdicaoRef;
  const categoria = categorias.find(c => c.nome === catNome);
  if (!categoria) return;
  const item = categoria.itens[idx];
  if (!item) return;

  // Campos b√°sicos
  item.nome = document.getElementById("pm-nome").value.trim();
  item.preco = parseFloat(document.getElementById("pm-preco").value) || 0;
  item.imagem = document.getElementById("pm-imagem").value.trim();
  item.descricao = document.getElementById("pm-descricao").value.trim();

  // Ingredientes permitidos e limites
  item.ingredientesPermitidos ||= {};
  item.limites ||= {};

  const wrap = document.getElementById("pm-grupos");
  wrap.querySelectorAll(".pm-grupo").forEach(bloco => {
    const grpName = bloco.querySelector(".pm-grupo-opcoes").dataset.grupo;
    const allCheck = bloco.querySelector(`.pm-grupo-all[data-grupo="${grpName}"]`);
    const limitInput = bloco.querySelector(`.pm-grupo-limit[data-grupo="${grpName}"]`);
    const limitVal = parseInt(limitInput.value) || 0;

    item.limites[grpName] = limitVal;

    if (allCheck.checked) {
      item.ingredientesPermitidos[grpName] = "*";
    } else {
      const selecionados = [...bloco.querySelectorAll(`.pm-opcao[data-grupo="${grpName}"]`)]
        .filter(i => i.checked)
        .map(i => i.value);
      if (selecionados.length > 0)
        item.ingredientesPermitidos[grpName] = selecionados;
      else
        delete item.ingredientesPermitidos[grpName];
    }
  });

  fecharProdutoModal();
  renderEditorProdutos();
  if (typeof renderCardapio === "function") renderCardapio();
  if (typeof salvarLocal === "function") salvarLocal();
});

// ===============================
// EXCLUIR PRODUTO
// ===============================
function excluirProduto(catNome, idx) {
  const categoria = categorias.find(c => c.nome === catNome);
  if (!categoria) return;
  if (confirm(`Excluir ${categoria.itens[idx].nome}?`)) {
    categoria.itens.splice(idx, 1);
    renderEditorProdutos();
    if (typeof renderCardapio === "function") renderCardapio();
    if (typeof salvarLocal === "function") salvarLocal();
  }
}

// ===============================
// GERENCIAMENTO DE GRUPOS DE PRODUTOS
// ===============================
document.getElementById("salvar-grupo-cardapio").addEventListener("click", () => {
  const nome = document.getElementById("novo-grupo-cardapio-nome").value.trim();
  if (!nome) return alert("Digite o nome do novo grupo de produtos!");

  if (categorias.some(c => c.nome.toLowerCase() === nome.toLowerCase()))
    return alert("Este grupo j√° existe!");

  categorias.push({ nome, itens: [] });
  document.getElementById("novo-grupo-cardapio-nome").value = "";
  refreshCategoriaSelect();
  renderEditorProdutos();
  if (typeof renderCardapio === "function") renderCardapio();
  if (typeof salvarLocal === "function") salvarLocal();
  alert(`‚úÖ Grupo "${nome}" criado com sucesso!`);
});

// ===============================
// GERENCIAMENTO DE INGREDIENTES (NOVO FORMATO COM VALOR)
// ===============================
document.getElementById("salvar-grupo").addEventListener("click", () => {
  const nome = document.getElementById("novo-grupo-nome").value.trim();
  if (!nome) return alert("Digite o nome do grupo de ingredientes!");

  if (ingredientes.some(g => g.grupo.toLowerCase() === nome.toLowerCase()))
    return alert("Esse grupo j√° existe!");

  ingredientes.push({ grupo: nome, opcoes: [] });
  if (typeof atualizarSelectGrupos === "function") atualizarSelectGrupos();
  renderEditorIngredientes();
  if (typeof salvarLocal === "function") salvarLocal();
  document.getElementById("novo-grupo-nome").value = "";
  alert(`‚úÖ Grupo "${nome}" criado com sucesso!`);
});

function atualizarSelectGrupos() {
  const sel = document.getElementById("novo-grupo");
  if (!sel) return;
  sel.innerHTML = "";
  ingredientes.forEach(g => {
    const opt = document.createElement("option");
    opt.value = g.grupo;
    opt.textContent = g.grupo;
    sel.appendChild(opt);
  });
}

// ===============================
// SALVAR INGREDIENTE (COM VALOR)
// ===============================
document.getElementById("salvar-ingrediente").addEventListener("click", () => {
  const grupo = document.getElementById("novo-grupo").value;
  const nome = document.getElementById("novo-ingrediente").value.trim();
  const valor = parseFloat(document.getElementById("novo-ingrediente-valor").value) || 0;

  if (!nome) return alert("Digite o nome do ingrediente!");

  let grupoExistente = ingredientes.find(g => g.grupo === grupo);
  if (!grupoExistente) {
    grupoExistente = { grupo, opcoes: [] };
    ingredientes.push(grupoExistente);
  }

  grupoExistente.opcoes.push({ nome, valor, pausado: false });
  document.getElementById("novo-ingrediente").value = "";
  document.getElementById("novo-ingrediente-valor").value = "";
  renderEditorIngredientes();
  if (typeof salvarLocal === "function") salvarLocal();
});

// ===============================
// RENDERIZAR EDITOR DE INGREDIENTES
// ===============================
function renderEditorIngredientes() {
  const cont = document.getElementById("ingredientes-editor");
  if (!cont) return;
  cont.innerHTML = "";

  atualizarSelectGrupos();

  ingredientes.forEach(g => {
    const div = document.createElement("div");
    div.style = "background:#fff;margin:1rem 0;padding:0.6rem;border-radius:8px;box-shadow:0 0 4px #ccc;";
    div.innerHTML = `<h4 style="color:var(--primary);">${g.grupo}</h4>`;

    (g.opcoes || []).forEach((op, idx) => {
      const btnPause = op.pausado
        ? `<button class='btn-on' onclick="alternarIngrediente('${g.grupo.replace(/'/g, "\\'")}', ${idx})">Ativar</button>`
        : `<button class='btn-off' onclick="alternarIngrediente('${g.grupo.replace(/'/g, "\\'")}', ${idx})">Pausar</button>`;

      const linha = document.createElement("div");
      linha.style = "margin:4px 0;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;";
      linha.innerHTML = `
        <div>
          <span style="${op.pausado ? "color:#999;text-decoration:line-through;" : ""}">
            ${op.nome} <small style="color:#555;">(R$ ${Number(op.valor || 0).toFixed(2)})</small>
          </span>
          <input type="number" step="0.01" min="0" value="${op.valor || 0}" 
                 style="width:70px;margin-left:10px;padding:2px 4px;border:1px solid #ccc;border-radius:4px;"
                 onchange="atualizarValorIngrediente('${g.grupo.replace(/'/g, "\\'")}', ${idx}, this.value)">
        </div>
        <div>${btnPause}
          <button class='btn-delete' onclick="excluirIngrediente('${g.grupo.replace(/'/g, "\\'")}', ${idx})">Excluir</button>
        </div>
      `;
      div.appendChild(linha);
    });

    cont.appendChild(div);
  });
}

function atualizarValorIngrediente(grupoNome, idx, valorNovo) {
  const grupo = ingredientes.find(g => g.grupo === grupoNome);
  if (!grupo) return;
  grupo.opcoes[idx].valor = parseFloat(valorNovo) || 0;
  if (typeof salvarLocal === "function") salvarLocal();
}

function alternarIngrediente(grupoNome, idx) {
  const grupo = ingredientes.find(g => g.grupo === grupoNome);
  if (!grupo) return;
  grupo.opcoes[idx].pausado = !grupo.opcoes[idx].pausado;
  renderEditorIngredientes();
  if (typeof salvarLocal === "function") salvarLocal();
}

function excluirIngrediente(grupoNome, idx) {
  const grupo = ingredientes.find(g => g.grupo === grupoNome);
  if (!grupo) return;
  if (confirm(`Excluir ${grupo.opcoes[idx].nome}?`)) {
    grupo.opcoes.splice(idx, 1);
    renderEditorIngredientes();
    if (typeof salvarLocal === "function") salvarLocal();
  }
}

// ===============================
// IMPORTA√á√ÉO DE JSON (COMPAT√çVEL COM VALOR)
// ===============================
document.getElementById("import-json").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return alert("Nenhum arquivo selecionado!");

  const reader = new FileReader();
  reader.onload = function () {
    try {
      const data = JSON.parse(reader.result);
      if (!data || (!data.categorias && !data.ingredientes)) {
        alert("‚ùå Arquivo inv√°lido!");
        return;
      }

      if (Array.isArray(data.categorias)) categorias = data.categorias;
      if (Array.isArray(data.ingredientes)) ingredientes = data.ingredientes;

      // Garante compatibilidade (caso ingredientes antigos n√£o tenham valor)
      ingredientes.forEach(g => {
        g.opcoes = g.opcoes.map(op => ({
          nome: op.nome,
          pausado: op.pausado || false,
          valor: op.valor || 0
        }));
      });

      localStorage.setItem("palatarius_data", JSON.stringify({ categorias, ingredientes }));
      renderCardapio();
      renderEditorProdutos();
      renderEditorIngredientes();

      alert("‚úÖ Importa√ß√£o conclu√≠da com sucesso!");
      console.log("üì¶ Dados importados:", data);
    } catch (err) {
      console.error("Erro ao importar JSON:", err);
      alert("‚ùå Erro ao importar JSON!");
    }
  };
  reader.readAsText(file);
});
</script>

<script>
/* =========================================================
   BLOCO 5 ‚Äî DADOS INICIAIS DO CARD√ÅPIO PALATARIUS
========================================================= */

window.addEventListener("DOMContentLoaded", initializeDefaultData);

function initializeDefaultData() {
  // ===============================
  // üçî GRUPOS DE PRODUTOS
  // ===============================
  categorias = [
    {
      nome: "Hamb√∫rgueres",
      itens: [
        { nome: "Hadouken", preco: 10.50, imagem: "hadouken.jpg", descricao: "O golpe cl√°ssico da Palatarius! P√£o americano macio com gergelim, carne artesanal 60g (blend bovino + bacon ou calabresa), ovo, alface e tomate frescos, ketchup e maionese especial. Um hamb√∫rguer imbat√≠vel ‚Äî r√°pido, direto e cheio de poder!", limites: { "Carnes":1, "Molhos":1, "Crocantes Extras":1 }},
        { nome: "Fatality", preco: 11.00, imagem: "fatality.jpg", descricao: "Explos√£o de sabor que nocauteia a fome! X-Bacon artesanal com carne 60g, queijo derretido, ovo, salada fresca e bacon crocante. O golpe final do sabor ‚Äî um verdadeiro campe√£o das arenas!", limites: { "Carnes":1, "Molhos":1, "Crocantes Extras":1 }},
        { nome: "Chamas do Drag√£o", preco: 11.00, imagem: "chamas_dragao.jpg", descricao: "Intenso como o cosmo! Blend calabresa artesanal 60g, queijo derretido, ovo, salada fresca, e fatias de calabresa na chapa. Finalizado com ketchup e maionese Palatarius. Perfeito para quem carrega o fogo sagrado da fome!", limites: { "Carnes":1, "Molhos":2, "Crocantes Extras":1 }},
        { nome: "Kamehameha", preco: 18.00, imagem: "kamehameha.jpg", descricao: "Poder em dobro! Dois blends artesanais 60g, dois ovos, queijo, bacon, calabresa, presunto, milho, ervilha e batata palha. Energia pura que explode em sabor ‚Äî um lanche lend√°rio!", limites: { "Carnes":2, "Molhos":2, "Crocantes Extras":2 }},
        { nome: "Modo Bijuu", preco: 25.00, imagem: "modo_bijuu.jpg", descricao: "For√ßa m√°xima! Tr√™s blends de 60g, tr√™s ovos, queijo, bacon, presunto, milho, ervilha e batata palha. Um chakra de sabor para quem quer liberar o monstro da fome interior!", limites: { "Carnes":3, "Molhos":2, "Crocantes Extras":2 }},
        { nome: "Banquete do Luffy", preco: 12.00, imagem: "banquete_luffy.jpg", descricao: "O X-Tudo dos piratas! Blend artesanal 60g, ovo, salada, bacon, presunto, queijo, milho, ervilha e batata palha. Um banquete digno do Capit√£o do Chap√©u de Palha!", limites: { "Carnes":1, "Molhos":2, "Crocantes Extras":1 }},
        { nome: "De Volta pro Sabor", preco: 9.50, imagem: "de_volta_sabor.jpg", descricao: "O cl√°ssico que nunca sai de moda! P√£o americano, carne artesanal suculenta, cheddar cremoso e molho de alho torrado. Simples e cheio de personalidade ‚Äî puro sabor em cada mordida!", limites: { "Carnes":1, "Molhos":1, "Crocantes Extras":1 }},
        { nome: "Exterminador de Fome", preco: 14.00, imagem: "exterminador_fome.jpg", descricao: "O poder do cheddar em dose dupla! Duas carnes artesanais 60g, duas camadas de cheddar derretido, molho especial Palatarius, e p√£o americano com gergelim. Uma m√°quina de sabor ‚Äî 'I'll be back... pra mais um!'", limites: { "Carnes":2, "Molhos":2, "Crocantes Extras":1 }},
        { nome: "Jurassic Chick", preco: 12.00, imagem: "jurassic_chick.jpg", descricao: "Croc√¢ncia e cremosidade em perfeita harmonia! Fil√© de frango empanado, cheddar, alface americana, molho de alho torrado e p√£o com gergelim. Um cl√°ssico jur√°ssico!", limites: { "Carnes":1, "Molhos":1, "Crocantes Extras":1 }},
        { nome: "Matrix Verde", preco: 9.50, imagem: "matrix_verde.jpg", descricao: "Frescor e sabor artesanal! P√£o americano, carne artesanal, molho Palatarius, alface americana crocante e tomate fresco. Escolha o sabor da realidade!", limites: { "Carnes":1, "Molhos":1, "Crocantes Extras":0 }},
        { nome: "Ca√ßadores da Gema Perdida", preco: 11.00, imagem: "egg_palatarius.jpg", descricao: "Um cl√°ssico artesanal com sabor de casa! P√£o americano, carne artesanal, queijo mussarela e ovo frito no ponto perfeito.", limites: { "Carnes":1, "Molhos":1, "Crocantes Extras":0 }}
      ]
    },
    {
      nome: "Batatas",
      itens: [
        { nome: "Final Boss", preco: 55.00, imagem: "final_boss.jpg", descricao: "Desafio √©pico! Batatas crocantes 35cm cobertas com bacon, calabresa, ovos de codorna, azeitonas, queijo ralado e cheddar cremoso.", limites: { "Prote√≠nas":2, "Acompanhamentos":6 }},
        { nome: "Smash Bros", preco: 6.00, imagem: "smash_bros.jpg", descricao: "Vers√£o compacta e saborosa. Batata crocante com bacon, calabresa e cheddar.", limites: { "Prote√≠nas":2, "Acompanhamentos":4 }},
        { nome: "Fatality Batata", preco: 45.00, imagem: "fatality_batata.jpg", descricao: "Batatas crocantes com calabresa, cheddar, bacon e ovos de codorna, frango a passarinho, an√©is de cebola e nuggets, com 2 molhos especiais.", limites: { "Prote√≠nas":3, "Molhos":2, "Acompanhamentos":6 }},
        { nome: "Brutality", preco: 55.00, imagem: "brutality.jpg", descricao: "Batatas crocantes com calabresa, cheddar, bacon, ovos de codorna e acompanhamentos premium com molhos Palatarius.", limites: { "Prote√≠nas":3, "Acompanhamentos":6 }}
      ]
    },
    {
      nome: "Batatas Recheadas",
      itens: [
        { nome: "Power Mash", preco: 12.00, imagem: "power_mash.jpg", descricao: "Pur√™ cremoso de batatas com queijo derretido. Escolha 1 prote√≠na e at√© 18 acompanhamentos.", limites: { "Prote√≠nas":1, "Acompanhamentos":5 }},
        { nome: "DeLorean Pot", preco: 18.00, imagem: "delorean_pot.jpg", descricao: "Vers√£o fam√≠lia com pur√™, 2 prote√≠nas e acompanhamentos. Cremosa e nost√°lgica!", limites: { "Prote√≠nas":2, "Acompanhamentos":6 }},
        { nome: "Miss√£o Cheddar", preco: 15.00, imagem: "missao_cheddar.jpg", descricao: "Recheada com bacon, cheddar e catupiry derretido. Uma miss√£o imposs√≠vel de resistir!", limites: { "Molhos":1, "Acompanhamentos":3 }},
        { nome: "Supremo T-800", preco: 20.00, imagem: "supremo_t800.jpg", descricao: "Dupla de prote√≠nas, muito cheddar, bacon e croc√¢ncia. Pot√™ncia total!", limites: { "Prote√≠nas":2, "Molhos":2 }}
      ]
    },
    {
      nome: "Past√©is",
      itens: [
        { nome: "Pastel Shuriken", preco: 10.00, imagem: "pastel_shuriken.jpg", descricao: "Pastel 15cm ‚Äî crocante e r√°pido no gatilho! Monte o seu com 1 prote√≠na e acompanhamentos.", limites: { "Prote√≠nas":1, "Acompanhamentos":4 }},
        { nome: "Pastel Grand Line", preco: 15.00, imagem: "pastel_grand_line.jpg", descricao: "Pastel 25cm ‚Äî tamanho de aventura! Monte o seu com 2 prote√≠nas e acompanhamentos √† sua escolha.", limites: { "Prote√≠nas":2, "Acompanhamentos":6 }}
      ]
    },
    {
      nome: "Cachorros-Quentes",
      itens: [
        { nome: "Hot Dog Noob Raiz", preco: 11.50, imagem: "hotdog_noob_raiz.jpg", descricao: "O cl√°ssico da base! P√£o, salsicha ou lingui√ßa, legumes e molhos Palatarius. Finalizado com batata palha e ovo de codorna.", limites: { "Molhos":2, "Acompanhamentos":4 }},
        { nome: "Prensado Obby", preco: 13.00, imagem: "prensado_obby.jpg", descricao: "Hot dog prensado com pur√™, batata palha, queijo ralado e ovo. Um cl√°ssico lend√°rio!", limites: { "Molhos":2, "Acompanhamentos":5 }},
        { nome: "Prensado Modo Criativo", preco: 18.00, imagem: "modo_criativo.jpg", descricao: "Crie seu lanche do seu jeito! Escolha prote√≠na extra e at√© 18 ingredientes. Seu sabor, suas regras!", limites: { "Prote√≠nas":2, "Molhos":3, "Acompanhamentos":6 }}
      ]
    },
    {
      nome: "Sorvetes & A√ßa√≠s",
      itens: [
        { nome: "A√ßa√≠ Palatarius", preco: 15.00, imagem: "acai_palatarius.jpg", descricao: "A√ßa√≠ cremoso com 4 toppings e 2 caldas. Doce e refrescante!", limites: { "Toppings":4, "Caldas":2 }},
        { nome: "Ta√ßa Suprema", preco: 18.00, imagem: "taca_suprema.jpg", descricao: "Sorvete + a√ßa√≠ com caldas Fini e toppings variados.", limites: { "Toppings":5, "Caldas":3 }}
      ]
    },
    {
      nome: "Bebidas",
      itens: [
        { nome: "Guaracamp Copo", preco: 2.00, imagem: "guaracamp.jpg", descricao: "Copo gelado de Guaracamp, refrescante e delicioso!" },
        { nome: "Refrigerante Mini 200ml", preco: 3.00, imagem: "refri_mini.jpg", descricao: "Mini refri gelado, 200ml de sabor!" },
        { nome: "√Ågua com G√°s", preco: 3.50, imagem: "agua_gas.jpg", descricao: "√Ågua gaseificada cristalina, perfeita para acompanhar." },
        { nome: "√Ågua sem G√°s", preco: 3.50, imagem: "agua_semgas.jpg", descricao: "√Ågua mineral pura e gelada." },
        { nome: "Refrigerante Lata 350ml", preco: 5.50, imagem: "refri_lata.jpg", descricao: "Refrigerante 350ml, geladinho!" },
        { nome: "Convec√ß√£o 2L", preco: 7.50, imagem: "convencao_2l.jpg", descricao: "Refresco fam√≠lia 2L, ideal para compartilhar." },
        { nome: "Refrigerante Sabores 2L", preco: 12.00, imagem: "refri_2l.jpg", descricao: "Guaran√°, Laranja e outros sabores 2L." },
        { nome: "Coca-Cola 2L", preco: 14.00, imagem: "coca_2l.jpg", descricao: "A cl√°ssica Coca-Cola 2 litros, sempre perfeita!" }
      ]
    }
  ];

  // ===============================
  // üßÇ INGREDIENTES PADR√ÉO
  // ===============================
  ingredientes = [
    { grupo: "Carnes", opcoes: [
      { nome: "Blend Ac√©m Bovino + Bacon", pausado: false },
      { nome: "Blend Ac√©m Bovino + Costela Bovina", pausado: false }
    ]},
    { grupo: "Molhos", opcoes: [
      { nome: "Billy Jack" }, { nome: "Ketchup de Goiabada" }, { nome: "Ketchup de Goiabada Picante" },
      { nome: "Alho e Ervas Finas" }, { nome: "T√°rtaro" }, { nome: "Tasty" },
      { nome: "Molho de Bacon" }, { nome: "Molho Verde" }
    ]},
    { grupo: "Crocantes Extras", opcoes: [
      { nome: "Alho Torrado" }, { nome: "Cebola Crispy" }
    ]},
    { grupo: "Prote√≠nas", opcoes: [
      { nome: "Carne" }, { nome: "Frango" }, { nome: "Costela" }, { nome: "Pernil" }, { nome: "Calabresa" }
    ]},
    { grupo: "Acompanhamentos", opcoes: [
      { nome: "Bacon" }, { nome: "Presunto" }, { nome: "Ovo" }, { nome: "Milho Verde" },
      { nome: "Ervilha" }, { nome: "Passas" }, { nome: "Azeitona" }, { nome: "Tomate Cru" },
      { nome: "Cebola" }, { nome: "Champignon" }, { nome: "Palmito" }, { nome: "Cebola Crispy" },
      { nome: "Alho Torrado" }, { nome: "Queijo Minas" }, { nome: "Queijo Mussarela" },
      { nome: "Queijo Prato" }, { nome: "Catupiry" }, { nome: "Cheddar" }, { nome: "Or√©gano" }, { nome: "Queijo Parmes√£o" }
    ]},
    { grupo: "Toppings", opcoes: [
      { nome: "Canudo de Biscoito" }, { nome: "Sucrilhos" }, { nome: "Granola" },
      { nome: "Amendoim" }, { nome: "Pa√ßoca" }, { nome: "Granulado" },
      { nome: "Flocos de Arroz" }, { nome: "Aveia" }, { nome: "Chocoball" },
      { nome: "Jujuba" }, { nome: "Delicado" }, { nome: "Leite em P√≥" }
    ]},
    { grupo: "Caldas", opcoes: [
      { nome: "Chocolate" }, { nome: "Morango" }, { nome: "Brigadeiro" },
      { nome: "Leite Condensado" }, { nome: "Amendoim" }, { nome: "Floresta Negra" },
      { nome: "Banana Caramelada" }, { nome: "Lim√£o" }, { nome: "Chocomenta" }, { nome: "Menta" }
    ]},
    { grupo: "Caldas Fini (+R$1)", opcoes: [
      { nome: "Fini Dentaduras" }, { nome: "Fini Bananas" }, { nome: "Fini Beijos" }
    ]}
  ];

  renderCardapio();
}
</script>
<script>
/* =========================================================
   BLOCO 6 ‚Äî EXPORTA√á√ÉO FUNCIONAL GARANTIDA (v10.1)
   Gera .JSON e .TXT mesmo offline / local / GitHub
========================================================= */

// Caminho online (usado s√≥ quando publicado no GitHub Pages)
const JSON_URL = "https://eddyoliver.github.io/Palatarius/cardapio_palatarius.json";

// ----------------------------------------------------------
// RESTAURA√á√ÉO SEGURA  (ignora falhas de rede sem travar nada)
// ----------------------------------------------------------
async function restaurarLocal() {
  try {
    const response = await fetch(JSON_URL + "?v=" + Date.now());
    if (!response.ok) throw new Error("Erro ao buscar remoto");
    const data = await response.json();
    categorias = data.categorias || [];
    ingredientes = data.ingredientes || [];
    renderCardapio(); renderEditorProdutos(); renderEditorIngredientes();
    localStorage.setItem("palatarius_data", JSON.stringify(data));
    console.log("‚úÖ Dados carregados do GitHub Pages.");
  } catch (err) {
    console.warn("‚ö†Ô∏è  Falha de rede ou CORS ‚Äî usando dados locais.", err);
    const local = localStorage.getItem("palatarius_data");
    if (local) {
      const obj = JSON.parse(local);
      categorias = obj.categorias || [];
      ingredientes = obj.ingredientes || [];
    }
    renderCardapio(); renderEditorProdutos(); renderEditorIngredientes();
  }
}

// ----------------------------------------------------------
// EXPORTADOR UNIVERSAL  (.json ou .txt)
// ----------------------------------------------------------
function exportarCardapio(formato = "json") {
  try {
    const data = {
      atualizado_em: new Date().toISOString(),
      versao: "10.1",
      categorias: JSON.parse(JSON.stringify(categorias || [])),
      ingredientes: JSON.parse(JSON.stringify(ingredientes || []))
    };

    data.ingredientes.forEach(gr => {
      gr.opcoes = gr.opcoes.map(op => ({
        nome: op.nome || "Ingrediente",
        valor: op.valor !== undefined ? Number(op.valor) : 0,
        pausado: !!op.pausado
      }));
    });

    const conteudo = JSON.stringify(data, null, 2);
    const tipo = formato === "txt" ? "text/plain" : "application/json";
    const nome = formato === "txt" ? "cardapio_palatarius.txt" : "cardapio_palatarius.json";

    const blob = new Blob([conteudo], { type: tipo });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = nome;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(a.href);

    console.log(`‚úÖ Exportado ${nome} (${blob.size} bytes)`);
    alert(`üì¶ Card√°pio exportado com sucesso!\nArquivo: ${nome}`);
  } catch (err) {
    console.error("‚ùå Erro ao exportar:", err);
    alert("Erro ao gerar o arquivo. Veja o console (F12).");
  }
}

// ----------------------------------------------------------
// BOT√ïES DE EXPORTA√á√ÉO + FECHAR EDITOR (sempre criados)
// ----------------------------------------------------------
window.addEventListener("load", async () => {
  // tenta carregar dados (mas n√£o trava se falhar)
  try { await restaurarLocal(); } catch(e) {}

  const editor = document.getElementById("editor-cardapio");
  if (editor) {
    // bot√£o JSON
    const btnJson = document.createElement("button");
    btnJson.textContent = "üì§ Exportar JSON (Online)";
    btnJson.className = "primary";
    btnJson.style = "margin-top:1rem;";
    btnJson.onclick = () => exportarCardapio("json");

    // bot√£o TXT
    const btnTxt = document.createElement("button");
    btnTxt.textContent = "üßæ Exportar TXT (Offline)";
    btnTxt.className = "secondary";
    btnTxt.style = "margin-top:0.5rem;";
    btnTxt.onclick = () => exportarCardapio("txt");

    editor.appendChild(btnJson);
    editor.appendChild(btnTxt);
  }

  const closeBtn = document.getElementById("close-editor");
  if (closeBtn)
    closeBtn.onclick = () => {
      localStorage.setItem("palatarius_data", JSON.stringify({ categorias, ingredientes }));
      document.getElementById("editor-screen").classList.remove("active");
      alert("‚úÖ Editor fechado. Exporte o JSON/TXT para salvar as altera√ß√µes!");
    };

  console.log("üöÄ Palatarius v10.1 ‚Äî bot√£o de exporta√ß√£o sempre ativo.");
});
</script>
<script>
const btnVisite = document.getElementById("visite-btn");
const modalVisite = document.getElementById("visite-modal");
const fecharVisite = document.getElementById("fechar-visite");

btnVisite.addEventListener("click", () => modalVisite.style.display = "flex");
fecharVisite.addEventListener("click", () => modalVisite.style.display = "none");
modalVisite.addEventListener("click", e => {
  if (e.target === modalVisite) modalVisite.style.display = "none";
});
</script>


</body>
</html>
